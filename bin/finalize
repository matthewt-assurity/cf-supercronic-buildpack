#!/usr/bin/env bash

# https://www.howtogeek.com/782514/how-to-use-set-and-pipefail-in-bash-scripts-on-linux/
set -euo pipefail 

# https://docs.cloudfoundry.org/buildpacks/understand-buildpacks.html
BUILD_DIR="${1}"
CACHE_DIR="${2}"
DEPS_DIR="${3}"
DEPS_IDX="${4}"

BUILDPACK_DIR=$(dirname $(readlink -f ${BASH_SOURCE%/*}))

output_dir=$(mktemp -d -t finalizeXXX)

SUPERCRONIC_DIR="${DEPS_DIR}/${DEPS_IDX}/supercronic"
SUPERCRONIC=supercronic-linux-amd64

echo "Running ls on DEPS_DIR"
ls "${DEPS_DIR}"

echo "running supercronic FINALIZE"

echo "-----> Installing Supercronic"
mkdir -p "${SUPERCRONIC_DIR}"
cp "${CACHE_DIR}/${SUPERCRONIC}" "${SUPERCRONIC_DIR}"

echo "Running ls on DEPS_DIR/DEPS_IDX"
ls "${DEPS_DIR}/${DEPS_IDX}"

chmod +x "${SUPERCRONIC_DIR}/${SUPERCRONIC}"